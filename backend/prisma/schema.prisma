// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                     Int                     @id @default(autoincrement())
  email                  String                  @unique
  name                   String?
  password               String
  role                   Role                    @default(TECHNICIAN)
  created_at             DateTime                @default(now())
  updated_at             DateTime                @updatedAt
  preventiveMaintenances PreventiveMaintenance[]
  workOrders             WorkOrder[]

  @@map("users")
}

enum Role {
  ADMIN
  TECHNICIAN
  REQUESTER
}

model Asset {
  id            Int       @id @default(autoincrement())
  name          String
  category_id   Int
  location      String?
  status        Status    @default(ACTIVE)
  purchase_date DateTime?
  description   String?
  created_at    DateTime  @default(now())
  updated_at    DateTime  @updatedAt

  category               AssetCategory           @relation(fields: [category_id], references: [id])
  preventiveMaintenances PreventiveMaintenance[]

  @@map("assets")
}

enum Status {
  ACTIVE
  DOWN
}

model AssetCategory {
  id   Int    @id @default(autoincrement())
  name String @unique

  assets Asset[]

  @@map("asset_categories")
}

model PreventiveMaintenance {
  id             Int      @id @default(autoincrement())
  asset_id       Int
  title          String
  description    String
  frequency      String
  next_due_date  DateTime
  last_done_date DateTime
  assigned_to    Int?
  is_active      Status   @default(ACTIVE)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  asset      Asset       @relation(fields: [asset_id], references: [id])
  user       User?       @relation(fields: [assigned_to], references: [id])
  workOrders WorkOrder[]

  @@map("preventive_maintenances")
}

model WorkOrder {
  id             Int        @id @default(autoincrement())
  pm_schedule_id Int?
  asset_id       Int
  title          String
  description    String
  status         WorkStatus @default(OPEN)
  priority       Priority   @default(MEDIUM)
  requested_by   Int
  created_at     DateTime   @default(now())
  updated_at     DateTime   @updatedAt

  pm_schedule PreventiveMaintenance? @relation(fields: [pm_schedule_id], references: [id])
  user        User                   @relation(fields: [requested_by], references: [id])

  @@map("work_orders")
}

enum WorkStatus {
  OPEN
  IN_PROGRESS
  COMPLETED
}

enum Priority {
  HIGH
  MEDIUM
  LOW
}
